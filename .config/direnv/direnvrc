# ~/.config/direnv/direnvrc
# Recursively load .env files from .envrc location down to current directory
# Order: parent first â†’ child overrides

load_dotenvs_recursive() {
  # Find the .envrc file that triggered this evaluation
  local envrc_path
  envrc_path="$(find_up .envrc)"
  
  if [[ -z "$envrc_path" ]]; then
    return
  fi
  
  local envrc_dir
  envrc_dir="$(dirname "$envrc_path")"

  local target="$PWD"

  # If PWD is not under envrc_dir, just load the root .env
  if [[ "$target" != "$envrc_dir"* ]]; then
    [[ -f "$envrc_dir/.env" ]] && dotenv "$envrc_dir/.env"
    return
  fi

  # Collect directories from envrc_dir to PWD
  local -a dirs=()
  local path="$target"

  while [[ "$path" != "$envrc_dir" && "$path" != "/" ]]; do
    dirs=("$path" "${dirs[@]}")
    path="$(dirname "$path")"
  done

  # Load root .env first (parent)
  [[ -f "$envrc_dir/.env" ]] && dotenv "$envrc_dir/.env"

  # Then load each child directory's .env (children override parents)
  for dir in "${dirs[@]}"; do
    [[ -f "$dir/.env" ]] && dotenv "$dir/.env"
  done
}

load_dotenvs_recursive
